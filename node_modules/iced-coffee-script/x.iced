class Test
  constructor: ->
    @foo =
      bar: (callback) ->
        console.log 2
        do callback
        console.log 4

  testBAD: ->
    console.log 1
    await @foo.bar defer()
    console.log 3

  testOK: ->
    console.log 1
    @foo.bar ->
      console.log 3

do (new Test).testBAD
do console.log
do (new Test).testOK
