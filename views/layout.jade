doctype 5
html
  head
    title= title
  body
    block content
    script(src="/static/javascripts/sha512.js")
    script(src="/static/javascripts/underscore-min.js")
    script!= "salt = '" + salt + "'"
    script.
      hash = function (password) {
        return CryptoJS.SHA512(salt + password);
      }
    script(src='/static/javascripts/superagent.js')
    script.
      save = function () {
        var obj = {
          content: document.getElementById('content').value,
          published: document.getElementById('published').checked,
          password: hash(document.getElementById('password').value).toString()
        };
        superagent
          .put(location.pathname)
          .send(JSON.stringify(obj))
          .set('Accept', 'application/json')
          .set('Content-Type', 'application/json; charset=utf-8')
          .end()
      }
      document.getElementById('save').addEventListener('click', function (ev) {
        save();
        ev.preventDefault();
      }, false)
      var edit = function () {
        if (location.hash === "#edit") {
          document.getElementById('edit').style.display = 'block';
        }
      }
      window.addEventListener("hashchange", edit, false);
      document.addEventListener('DOMContentLoaded', edit, false);
